
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../2022-08-07-auth-bypass-headers/">
      
      
        <link rel="next" href="../Kubernetes_Pentesting/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.8">
    
    
      
        <title>Email Pentesting - Hacking Notes</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.0d440cfe.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#email-pentesting" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Hacking Notes" class="md-header__button md-logo" aria-label="Hacking Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Hacking Notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Email Pentesting
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Hacking Notes" class="md-nav__button md-logo" aria-label="Hacking Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Hacking Notes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Welcome to MkDocs
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Cheatsheets
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Cheatsheets
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
          General
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          General
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2022-07-30-file-transfers-101/" class="md-nav__link">
        File Transfers 101
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2022-07-30-pivot-101/" class="md-nav__link">
        Pivoting & Lateral Movement
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2022-08-07-auth-bypass-headers/" class="md-nav__link">
        Auth Bypass Headers"
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Email Pentesting
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Email Pentesting
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#understanding-email" class="md-nav__link">
    Understanding Email
  </a>
  
    <nav class="md-nav" aria-label="Understanding Email">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pop3" class="md-nav__link">
    POP3
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#imap" class="md-nav__link">
    IMAP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smtp" class="md-nav__link">
    SMTP
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stmp-command-cheat-sheet" class="md-nav__link">
    STMP Command Cheat Sheet
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pop3-command-cheat-sheet" class="md-nav__link">
    POP3 Command Cheat Sheet
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sending-emails" class="md-nav__link">
    Sending Emails
  </a>
  
    <nav class="md-nav" aria-label="Sending Emails">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sending-someone-a-mail-smtp" class="md-nav__link">
    Sending Someone a Mail SMTP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reading-someones-mail-pop3" class="md-nav__link">
    Reading Someones Mail POP3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#harvesting-users" class="md-nav__link">
    Harvesting Users
  </a>
  
    <nav class="md-nav" aria-label="Harvesting Users">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mutations" class="md-nav__link">
    Mutations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#useful-tools" class="md-nav__link">
    Useful Tools
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#username-enumeration" class="md-nav__link">
    Username Enumeration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bruteforce" class="md-nav__link">
    Bruteforce
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practical-exploitation" class="md-nav__link">
    Practical Exploitation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postfix-disclaimer" class="md-nav__link">
    PostFix Disclaimer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#status-codes" class="md-nav__link">
    Status Codes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusions" class="md-nav__link">
    Conclusions
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Kubernetes_Pentesting/" class="md-nav__link">
        Pentesting Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cheatsheet_js/" class="md-nav__link">
        Commands
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hydra_cheat_sheet/" class="md-nav__link">
        Hydra Cheat Sheet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../msfvenom_cheatsheet/" class="md-nav__link">
        MSFVenom Cheatsheet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../splunk_cheat_sheet/" class="md-nav__link">
        Splunk Cheatsheet
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
          Linux
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/2022-07-30-x-without-y/" class="md-nav__link">
        X Without Y (Living off the Land)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/Powershell_Empire/" class="md-nav__link">
        Powershell Empire
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Linux/linux/" class="md-nav__link">
        Linux 101
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
      
      
      
        <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
          Windows
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Windows
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Windows/101_windows/" class="md-nav__link">
        Windows Privilege Escalation 101
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Windows/2022-07-09-impacket/" class="md-nav__link">
        Impacket Toolset
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Windows/2022-07-10-bloodhound/" class="md-nav__link">
        BloodHound
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Windows/2022-08-10-golden-ticket/" class="md-nav__link">
        Golden Tickets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Windows/2023-01-15-101_icalcs/" class="md-nav__link">
        ICACLs 101
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Recon
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Recon
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Recon/mapping/" class="md-nav__link">
        Application Mapping
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Recon/recon/" class="md-nav__link">
        Recon and Information Gathering
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Web
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Web
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Web/web_hacking/" class="md-nav__link">
        Web Application Hacking
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Windows
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Windows
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Windows/PowerShell/" class="md-nav__link">
        PowerShell
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Windows/windows_101/" class="md-nav__link">
        Windows 101
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#understanding-email" class="md-nav__link">
    Understanding Email
  </a>
  
    <nav class="md-nav" aria-label="Understanding Email">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pop3" class="md-nav__link">
    POP3
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#imap" class="md-nav__link">
    IMAP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smtp" class="md-nav__link">
    SMTP
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stmp-command-cheat-sheet" class="md-nav__link">
    STMP Command Cheat Sheet
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pop3-command-cheat-sheet" class="md-nav__link">
    POP3 Command Cheat Sheet
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sending-emails" class="md-nav__link">
    Sending Emails
  </a>
  
    <nav class="md-nav" aria-label="Sending Emails">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sending-someone-a-mail-smtp" class="md-nav__link">
    Sending Someone a Mail SMTP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reading-someones-mail-pop3" class="md-nav__link">
    Reading Someones Mail POP3
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#harvesting-users" class="md-nav__link">
    Harvesting Users
  </a>
  
    <nav class="md-nav" aria-label="Harvesting Users">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mutations" class="md-nav__link">
    Mutations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#useful-tools" class="md-nav__link">
    Useful Tools
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#username-enumeration" class="md-nav__link">
    Username Enumeration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bruteforce" class="md-nav__link">
    Bruteforce
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practical-exploitation" class="md-nav__link">
    Practical Exploitation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postfix-disclaimer" class="md-nav__link">
    PostFix Disclaimer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#status-codes" class="md-nav__link">
    Status Codes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusions" class="md-nav__link">
    Conclusions
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="email-pentesting">Email Pentesting</h1>
<p>Email servers are complex beasts, if you've ever tried to configure one then you'll know the pain they can cause. With this in mind it's quite common to find them misconfigured in some way that we can take advantage of.</p>
<p>For the purpose of this we'll make use of the following clipped <code>nmap</code> scan of an email server from HackTheBox as our reference point as it looks to be a pretty typical example of what you might find in the wild or on a corporate network.</p>
<pre><code class="language-bash">22/tcp    open     ssh            syn-ack ttl 63 OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)
25/tcp    open     smtp           syn-ack ttl 63 Postfix smtpd
80/tcp    open     http           syn-ack ttl 63 Apache httpd 2.4.41 ((Ubuntu))
110/tcp   open     pop3           syn-ack ttl 63 Dovecot pop3d
143/tcp   open     imap           syn-ack ttl 63 Dovecot imapd (Ubuntu)
993/tcp   open     ssl/imap       syn-ack ttl 63 Dovecot imapd (Ubuntu)
995/tcp   open     ssl/pop3       syn-ack ttl 63 Dovecot pop3d
</code></pre>
<p>This will be explained in greater detail below, but the above example is a fairly standard mail server, you've got your SMTP daemon (Postfix) running to send mails, and you've also got something to retreive the mails, in this case we have Dovecot running both POP3 and IMAP daemons in SSL and non-SSL mode (that's 4 separate services for the purposes of enumeration). And your common or garden SSH port running on 22, just for completeness, which is generally how the administrator will access this machine.</p>
<blockquote>
<p>Take your time with email servers, aside from all the information they can give us there can often be vulnerabilities in the services themselves which can be exploited by interacting with them. Make sure to grab proper versions where possible to help with further enumeration.
{: .prompt-info }</p>
</blockquote>
<h2 id="understanding-email">Understanding Email</h2>
<p>Before we can attack something we need to at least have an understanding of what it is.</p>
<p>Email, or electronic mail is a terrible form of communication favoured by managers and the guy in the office who refuses to join Slack because it doesn't fit into his "Workflow". But it can still be useful for phishing and otherwise abusing to gain access to systems.</p>
<p>Mail is a simple thing, you send mails to a server and someone uses a client to access those emails. In the case of Outlook or something like that they are constantly polling the server and will download new mails when they arrive directly to your local machine, otherwise it would be a manual process (remember having to hit "Send/Receive" to get Outlook to send your mail back in the day?)</p>
<p>There are a few protocols we need to be familiar with to be able to properly interact with the email server.</p>
<blockquote>
<p>*We use <code>telnet</code> as it seems to handle the process a bit better than <code>nc</code>, though <code>nc</code> can do the job
{: .prompt-info }</p>
</blockquote>
<h3 id="pop3">POP3</h3>
<p>The "Post Office Protocol", or POP3 as it's generally called. As the name might suggest this is the protocol responsible for actually delivering the mails to users. POP3 servers communicate with the other mail protocols and essentially serve as your mailbox, you can log into the POP3 server (typically running on 110, and 995 in the SSL instance) and download your mail to your local machine or just view it on the server.</p>
<h3 id="imap">IMAP</h3>
<p>Another way of retreiving your mail, but it's much more suited to a larger environment as it handles multiple clients accessing the service simultaneously.</p>
<p>By default IMAP runs on ports 143 and 993 respective of if it's using SSL or not with the latter (995) being the one running on SSL. IMAP is the most common protocol for mail access alongside POP3.</p>
<h3 id="smtp">SMTP</h3>
<p>Simple Mail Transport Protocol, or SMTP is the defacto standard for <em>sending</em> emails. And it's what we'll be using for most of our testing as we can interact with the protocol via <code>telnet</code>* from our Kali machine.</p>
<p>Typically SMTP runs on port 25, with the secure version running on port 465 by default.</p>
<hr />
<h2 id="stmp-command-cheat-sheet">STMP Command Cheat Sheet</h2>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>HELO</code></td>
<td>Basic server greeting (older systems)</td>
</tr>
<tr>
<td><code>ELHO</code></td>
<td>Enhanced server greeting (newer systems)</td>
</tr>
<tr>
<td><code>MAIL FROM</code></td>
<td>Who the mail is from (can be easily spoofed)</td>
</tr>
<tr>
<td><code>RCPT TO</code></td>
<td>Who to send the mail to? user@email.address</td>
</tr>
<tr>
<td><code>SIZE</code></td>
<td>Because size matters</td>
</tr>
<tr>
<td><code>DATA</code></td>
<td>The actual body/content of the message we want to send</td>
</tr>
<tr>
<td><code>VRFY</code></td>
<td>Verify that there is a valid user to receive an email (useful!)</td>
</tr>
<tr>
<td><code>TURN</code></td>
<td>Invert the client/server relationship without spawning a new connection</td>
</tr>
<tr>
<td><code>AUTH</code></td>
<td>For when we need to actually log in</td>
</tr>
<tr>
<td><code>RSET</code></td>
<td>Essentially a "Cancel" button, closes current action without terminating connection</td>
</tr>
<tr>
<td><code>HELP</code></td>
<td>DON'T PANIC!</td>
</tr>
<tr>
<td><code>QUIT</code></td>
<td>Because this has all just become a bit too much</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="pop3-command-cheat-sheet">POP3 Command Cheat Sheet</h2>
<pre><code class="language-bash">USER &lt;username&gt;
PASS &lt;password&gt;
STAT
LIST
RETR
DELE
RSET
TOP
QUIT
</code></pre>
<p>POP3 is a simple beast and will only ever reply in one of the following ways:</p>
<pre><code class="language-bash">+OK
-ERR
</code></pre>
<hr />
<h2 id="sending-emails">Sending Emails</h2>
<p>Before we can start hacking email servers we need to know the basic protocol for sending and interacting with them.</p>
<h3 id="sending-someone-a-mail-smtp">Sending Someone a Mail SMTP</h3>
<pre><code class="language-html">$&gt; telnet 10.10.10.110 110
&lt;SERVER BANNER GOES HERE&gt;
&lt;Probably something about the creator&gt;
&gt; HELO hacker@fakedomain.com
OK
&gt; MAIL FROM: hacker@fakedomain.com
OK
&gt; RCPT TO: someone@gullible.com
OK
&gt; DATA
&lt;A message about how to end the mail, usually a &quot;.&quot; on its own line&gt;

Dear Mr Guillible,

We are writing to you today as our records show that you are known to respond to random unsolicited emails asking to hand over your information. Could you kindly send us you 16 digit card number and the 3 digit security code off the back of the credit card with the most money on it to the following email address:

stealing@allthethings.com

.

&lt;Confirmation message&gt;
&gt; QUIT
&lt;closing connection&gt;

$&gt;
</code></pre>
<h3 id="reading-someones-mail-pop3">Reading Someones Mail POP3</h3>
<pre><code class="language-bash">$&gt; telnet 10.10.10.110 25
&lt;SERVER BANNER GOES HERE&gt;
&lt;Probably something about the creator&gt;
USER someusername
+OK
PASS somepassword
+OK Mailbox open, 200 messages
LIST
+OK Mailbox scan listing follows
1 1823
2 1825
3 1819
RETR 1
+OK 1823 octets
--- MESSAGE CONTENT GOES HERE ---
</code></pre>
<hr />
<h2 id="harvesting-users">Harvesting Users</h2>
<p>The biggest problem you're going to have with testing an email server is figuring out who to target. The best place to get that sort of information would be the company website or ideally dump their entire AD listing of active users... but since we probably don't have access to the latter we'll have to make do with the former and try and scrape as much information as we can from a website or FTP server, or whatever else we can get our grubby paws on.</p>
<p>This writeup isn't supposed to be an OSINT primer, but that's kind of where you should be looking for more information on how to gather the kind of information that would be useful for this (emails and Names)</p>
<p>As well as names of potential people, we can also look at potential names for departments or teams as these will often have a shared mailbox even in small organisations.</p>
<h3 id="mutations">Mutations</h3>
<p>Again this isn't what we're really here to discuss, but one of the things you need to bear in mind is all the potential ways a persons name could end up as a username. Take the simple and common English name David Smith as an example.</p>
<pre><code class="language-bash">davidsmith
david.smith
dsmith
d.smith
smithd
smith.d
smith.david
smithdavid
</code></pre>
<p>That's one simple name and I've not even covered all of the possible mutations, we've not even covered the case if there are multiple people with that name, do they get numbers? There is no simple answer here unfortunately, although a pretty good one to test early is <code>david.smith</code> as that seems to be a pretty common one in most enterprises I've seen.</p>
<h3 id="useful-tools">Useful Tools</h3>
<ul>
<li>Your eyes (Voted #1 Most Useful Tool 2021)</li>
<li>Screenshot tools like <code>eyewitness</code></li>
<li><code>cewl</code> for scraping all of the words from a site/page</li>
<li><a href="https://bullsec.xyz/cheat_sheets/password_generation/">My Password Generation CheatSheet</a> could also be useful for generating mutations and otherwise creating unique wordlists to test</li>
</ul>
<hr />
<h2 id="username-enumeration">Username Enumeration</h2>
<p>Now we have an idea how what the usernames might look like and how we might go about harvesting them from the email server we can think about how to verify our findings. And we don't have to think too hard before we say "sod it" and write a Python script to do all the leg work for us.</p>
<pre><code class="language-python">#!/usr/bin/python

import socket 
import sys

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

ip = sys.argv[1]
input_file = sys.argv[2]

connect = s.connect((ip,25))
banner = s.recv(1024)
print(banner)

with open(input_file) as payloads:
        for p in payloads:
                s.send(&quot;VRFY &quot; + p.rstrip() + '\r\n')
                result = s.recv(1024)
                print(result)

s.close()
</code></pre>
<p>Give that bad boy a file with usernames and it will test them against the server using the very useful <code>VRFY</code> command. If the server isn't setup to respond to the <code>VRFY</code> command then it'll just fail and this isn't an option for you on this machine sadly, and it's likely that you're going to need to find credentials elsewhere.</p>
<hr />
<h2 id="bruteforce">Bruteforce</h2>
<p>When in doubt, get the sledgehammer out.</p>
<p>Or in our case <code>hydra</code>:</p>
<pre><code class="language-bash">hydra -L userlist.txt -P passlist.txt -f $ip pop3 -V
</code></pre>
<blockquote>
<p>One thing to try here is to use the userlist.txt as the passlist.txt as resetting a users password to their name can be quite a common fallback for some service desks
{: .prompt-info }</p>
</blockquote>
<p>Bruteforcing could take forever or it could be fast depending on the lists you've used. Patience is key and making sure you've done the <code>VRFY</code> step (if it was possible) to check that you're attacking valid users.</p>
<hr />
<h2 id="practical-exploitation">Practical Exploitation</h2>
<p>Once you've got your target list and you've gained some access, it's on you to figure out how to abuse those new permissions. But here are some ideas in case you were struggling:</p>
<ul>
<li>Send the admins/users generic phishing emails</li>
<li>Send mails to user groups</li>
<li>Read peoples mails and look for passwords</li>
<li>Abuse the mail and just troll people (don't do this)</li>
<li>Poison emails with malicious payloads that fire when they land</li>
</ul>
<p>Unless the mail server itself is vulnerable then you're essentially just looking at using the server to gain addtional information and potentially credentials to access other services.</p>
<h2 id="postfix-disclaimer">PostFix Disclaimer</h2>
<p>No this is nothing to do with me warning you about using Postfix. It's got more to do with:</p>
<p><code>/etc/postfix/disclaimer</code></p>
<p>A harmless sounding file, right? What could be dangerous about a disclaimer? But then why would I be highlighting it in a pentesting guide if it wasn't worth mentioning?</p>
<p>The <code>/etc/postfix/disclaimer</code> file is actually a BASH script that is sent along with every message. If for some reason we're able to modify that file then we'll be able to spawn a shell as whichever user is running the mail server simply by placing one at the top of the file under the shebang and setting up our listener accordingly.</p>
<blockquote>
<p><a href="https://www.exploit-db.com/exploits/6337">ExploitDB Link Explaining in Better Detail</a>
{: .prompt-info }</p>
</blockquote>
<hr />
<h2 id="status-codes">Status Codes</h2>
<p>When you send a command to the server it will respond with a Status Code followed by some message relating to whatever it is you just asked the server to do.</p>
<p><a href="https://kapeli.com/cheat_sheets/SMTP_Status_Codes.docset/Contents/Resources/Documents/index">SMTP Status Code Lookup</a></p>
<h2 id="conclusions">Conclusions</h2>
<p>Email is bad.</p>
<p>Email servers are fun.</p>
<p>Happy hacking.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.a00a7c5e.min.js"></script>
      
    
  </body>
</html>